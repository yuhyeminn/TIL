> 후쿠나가 유우지, 그림으로 배우는 네트워크 구조
>
> Chapter 2. TCP/IP 기초 지식

</br>

## TCP/IP

</br>

### TCP/IP 레이어 구성

 TCP/IP는 인터넷을 비롯한 컴퓨터 네트워크에서 널리 이용되는 통신 프로토콜이다. TCP/IP는 4층의 모델을 기반으로 해서 그 기능을 구성하고 있으며, 각 층은 아래에서부터 **네트워크 인터페이스층**, **인터넷층**, **트랜스포트층**, **애플리케이션층**이 쌓여있고 하위 층에서 구현한 기능은 상위의 층에서 활용된다.

- `네트워크 인터페이스층` : 직접 연결된 기기간의 통신하는 기능을 구현함 (이더넷, 네트워크 카드)

- `인터넷층` : 중계 등의 기능을 추가해서 다른 네트워크 내의 대상과 통신할 수 있는 기능을 구현함 (IP, ICMP)

- `트랜스포트층` : 고신뢰 등 목적에 맞는 통신 품질을 구현함 (TCP, UDP) 
  - TCP : 데이터의 확인이나 재전송 등을 수행하며 신뢰도가 높은 통신을 구현함
  - UDP : 통신을 가볍게 처리하도록 해서 실시간 성격이 큰 통신을 구현함

- `애플리케이션층` : 개별 애플리케이션들의 구체적인 통신 서비스를 구현함 (HTTP, SMTP, POP3, IMAP4)

  ** 애플리케이션은 각 층의 프로토콜을 조합하여 사용한다. 예를 들어 Web 서버 접속처럼 누락되면 곤란한 경우에는 신뢰도가 높은 TCP를 사용하고, 동영상 전송이나 인터넷 전화처럼 속도가 중요한 경우에는 실시간 성격이 강한 UDP를 사용한다.

</br>

### OSI 참조 모델과의 대응

 OSI 참조 모델은네트워크 표준규격인 OSI(Open Systems Interconnection)를 사용하는 통신 모델이다. OSI 아키텍처는 규격 내용이 복잡하여 프로그램화 시키기 어려워 그다지 보급되지 않았지만 TCP/IP는 간단하기 때문에 널리 사용되어 현재에 이르렀다.

- TCP/IP와 OSI의 대응 관계 - 완전하게 1:1 대응하진 않음
  - 네트워크 인터페이스층 - 물리층, 데이터링크층
  - 인터넷층 - 네트워크층
  - 트랜스포트층 - 트랜스포트층
  - 애플리케이션층 - 세션층, 표현층, 애플리케이션층

</br>

---

</br>

### 네트워크 인터페이스층

 TCP/IP 모델의 최하부에 위치한 네트워크 인터페이스층은 네트워크용 하드웨어에 직접 연결되어 있는 컴퓨터끼리 서로 통신 할 수 있도록 하는 기능을 구현한다. 단순한 최저 레벨의 통신기능을 초래하는 층이며 인터네트워킹 기능은 갖고있지 않다.



#### 주요 프로토콜

- `이더넷` : 유선 LAN에서 가장 주류인 네트워크 규격

- `Wi-Fi `: 무선을 사용해서 LAN에 접속하기 위한 규격

- `PPPoE(Point-to-Point Protocol over Ethernet)` : 이더넷을 사용해서 1:1 접속을 하는 프로토콜. 주로 인터넷   접속 서비스 이용자 인증에 사용됨.

- `ARP/RARP` : IP주소와 MAC주소(하드웨어 주소)를 서로 교환하기 위한 프로토콜. 이더넷이나 Wi-Fi에서 사용됨

  - ARP (Address Resolution Protocol, 주소 결정 프로토콜)

  - RARP (Reverse Address Resolution Protocol, 역순 주소 결정 프로토콜)

</br>

---

</br>

### 인터넷층

 인터넷층은 복수개의 네트워크를 연결해서 서로 패킷을 교환하는 인터 네트워킹 기능을 구현한다. 인터넷층은 직접 연결되어 있지 않은 컴퓨터끼리의 데이터(패킷)를 중계한다.

 패킷을 중계해서 특정 방향으로 전송하는 것을 **라우팅(routing)**이라고 한다. 라우팅이 이루어짐으로써 네트워크 인터페이스층만으로는 도달할 수 없었던 임의의 대상에게 데이터를 전송할 수 있게 된다.



#### 주요 프로토콜

- `IP` : 직접 연결되어 있지 않은 네트워크끼리 패킷을 라우팅하는 기능을 제공함.
  - IP주소 : IP에서 네트워크 전반에 걸쳐 컴퓨터를 각각 식별하기 위한 주소.
- `ICMP` : IP의 동작을 보조하기 위한 특수 기능을 보유한 프로토콜. 임의의 대상에게 도달할 수 있을지 검사하고 도착할 수 없는 경우의 이유를 통지하는 등에 사용됨.

</br>

---

</br>

### 트랜스포트층

 트랜스포트층은 네트워크의 사용 목적에 따른 특성을 가진 통신을 구현한다. 보다 신뢰도가 높은 통신을 가능하게 하거나 신뢰도가 낮더라도 재빨리 패킷을 전송하거나 한다.



#### 주요 프로토콜

- `TCP(Transmission Control Protocol)` : **신뢰도가 높은 통신**을 구현함. 초기 연결하여 통신이 완료되면 연결을 끊으며, 재전송이나 순서 재배치 등을 하므로 실시간성 작업에는 적합하지 않음.
- `UDP(User Datagram Protocol)` : 간단한 통신을 구현하여 **가벼운 통신** 기능을 제공. 사전 준비 업이 바로 통신을 시작하며 필요할 때 대상에게 바로 데이터를 보내고 도착한 데이터는 바로 애플리케이션으로 전달함.



#### TCP의 역할

 TCP는 **슬라이딩 윈도우** 구조로 구현되어 윈도우 프레임 내의 데이터는 수신확인을 기다리지 않고 송신하고 수신확인이 도착하면 오른쪽으로 옮겨가면서 다음 데이터를 송신하는 방법으로 신뢰도가 높고 효율이 좋은 통신을 구현한다.

1. 부여된 데이터 순서의 보증 (시퀀스 번호)
2. 수신 데이터의 오류 존재 여부에 대한 확인 (오류 검증)
3. 상대가 확실히 수신했는지 여부 확인 (긍정 확인 응답)
4. 수신받지 못한 데이터의 재전송 요청 (슬라이딩 윈도우)
5. 상대의 페이스에 맞춘 데이터 전송 (흐름 제어)
6. 네트워크의 혼잡 상황에 따른 송신 속도의 조정 (혼잡 제어)

** `슬라이딩 윈도우` : 정보 프레임을 이동시키는 기법으로 송수신의 진행상태, 누락된 패킷의 재전송, 패킷의 순서 보정 등을 관리함



#### TCP의 통신 절차

* **3-way handshake**
  - 통신을 시작할 때
    1. 클라이언트가 서버에게 `SYN 패킷`을 보내며 연결 요청
    2. 서버는 `SYN + ACK 패킷`을 되돌려 보냄
    3. 클라이언트가 이를 수신하고 `ACK 패킷`을 보냄으로써 연결 완료 상태가 됨
  - 통신을 종료할 때 - 시작할때와 절차는 동일하나 SYN 패킷 대신 `FIN 패킷`을 보냄

</br>

---

</br>

### 애플리케이션층

 애플리케이션층은 개별 애플리케이션이 갖고있는 기능을 구현하는 층이다. 여러개의 애플리케이션들의 통신을 담당한다.



#### 주요 프로토콜

- `HTTP` : Web으로의 접속에 사용됨
- `SMTP` : 메일 송신이나 서버 간의 전송에 사용됨
- `POP3` : 메일함에서 메일을 꺼냄
- `IMAP4` : 메일함의 메일을 읽음
- `FTP` : 파일을 전송함
- `SSH` : 문자 기반으로 서버 등에 명령을 하고 결과를 봄
- `DNS` 도메인명과 IP주소를 상호변환함
- `NTP` : 컴퓨터의 시간을 맞춤

</br>

---

</br>

### 레이어별 처리와 패킷의 관계

#### 전송하는 측의 처리와 헤더 추가

 전송측 레이어에서는 상위층에서 받은 데이터를 기반으로 통신을 처리하며 **통신 처리에 필요한 각종 정보를 데이터 본체 앞에 추가, 즉 헤더를 추가한 후 하위층으로 넘기고 처리를 종료한다.** 이 데이터를 받은 하위층 역시 동일하게 데이터를 처리하며 하위층을 거쳐갈수록 패킷의 전체 크기는 커지게 된다.

</br>

#### 수신받는 측의 처리와 헤더 제거

 데이터를 받는 측에서는 하위층에서 받은 패킷에 포함된 **헤더 부분의 정보를 사용해서 데이터를 처리하고, 처리가 끝나면 헤더 부분을 제거하고 데이터부분만을 상위층으로 넘긴다.** 상위층으로 데이터를 넘길 때마다 각 레이어별 헤더가 제거되므로 패킷 전체의 크기는 줄어들고 최종적으로 전송 측에서 최초에 내보낸 데이터만 남게 된다.

</br>

### IP 주소

 IP주소란 **IP라고 불리는 프로토콜을 사용하는 네트워크에서 각 컴퓨터를 식별하기 위해 컴퓨터에 부여된 번호**이다. 현재 사용되는 IP주소는 `IPv4` 와 `IPv6` 가 있으며 단순히 IP주소라고 하는 경우엔 오래전부터 사용해온 IPv4를 뜻한다. IPv6은 IPv4가 고갈됨에 따라 새로이 도입되었지만 아직 많이 사용되고 있진 않다.

 IP주소는 `ICANN(Internet Corporation for Assigned Names and Numbers)` 에서 관리하며 ICANN에서 지역 인터넷 레지스트리(한국은 APNIC)에 대해 IP주소의 일정 범위를 할당받고 또 다시 아래 계층의 조직들에게 할당되어 최종적으로 가정이나 사무실에 할당된다. 

</br>

##### ** 계층적으로 할당되는 IP주소

**`ICANN` → `지역 인터넷 레지스트리(APNIC)` → `국가별 인터넷 레지스트리(KRNIC)` → `로컬 인터넷 레지스트리(ISP 등)` → `사용자(가정 및 사무실 등)`**

`APNIC`은 아시아 태평양 지역의 네트워크 자원을 관리하는 조직, `KRNIC`은 한국의 네트워크 자원을 관리하는 조직이다.

</br>

### 포트번호

 포트번호는 트랜스포트층에서 TCP 또는 UDP가 제공하는 기능이 대상이 갖고 있는 어떤 기능과 접속할지 지정하기 위해 사용한다. IP주소와 포트번호를 이용하여 어떤 컴퓨터의 어떤 기능의 사용과 같은 형식으로 지정할 수 있게 된다. 

 포트번호는 숫자 한 개로 표현되며 그 값의 범위는 `0~65535`이다. 이 중 `0~1023`까지의 포트 번호는 **잘 알려진 포트(well-known port)** 라고 불린다.

#### TCP 에서의 포트번호

 통신을 시작할 때 연결하기 위해 대상의 IP주소에 맞춰 대상의 서비스를 특정하는 포트 번호를 지정한다. 이 때 통신을 시작하는 측의 컴퓨터도 포트 번호를 한 개 사용하고 있다. 자신의 포트는 대상이 정보를 되돌려 보내는 곳이 되거나 동일한 대상의 동일한 포트로 복수 접속하고 있을 때 각각을 구별하는 역할도 한다.

</br>

### 전역 IP와 사설 IP

 전 세계에서 유일한 IP주소는 `전역IP주소(공인 IP주소)`라고 불리며, 그렇지 않은 것은 `사설IP주소`라고 불린다. 사설 IP 주소는 조직이나 가정 등의 내부 네트워크에서 사용되며 어떤 조직과 그 외 다른 조직에서 사설 IP 주소가 중복되더라도 전혀 문제 없다. 사설 IP주소는 한 네트워크 내에서 중복되지 않고 컴퓨터가 식별되기만 하면 된다.

</br>

### IP 주소의 클래스와 넷마스크

 IP주소는 32비트로 표시하며 왼쪽의 **네트워크부**와 오른쪽의 **호스트부**라고 불리는 부분으로 나눌 수 있다. 네트워크부는 어떤 네트워크를 특정하는 정보이며 호스트부는 그 네트워크 안에 있는 컴퓨터를 특정한다.

#### IP주소의 클래스

 IP주소의 클래스는 A~E 까지 있으며 D와 E는 특수한 용도로 사용되고, 일반적으로 사용되는 클래스는 A~C이다. 클래스 A~C의 차이는 한 개의 네트워크 주소 안에서 몇 대의 컴퓨터를 구별할 수 있는가, 즉 네트워크 규모의 차이다. 클래스 A는 최대 대규모 네트워크용, 클래스 B는 중간 규모용, 클래스 C는 소규모 네트워크용이다.

`클래스 A` :  네트워크부 8비트. 선두비트 0 (최대 128개 네트워크) | 0.0.0.0 ~ 127.255.255.255

`클래스 B` : 네트워크부 16비트. 선두비트 10 (최대 16,384개 네트워크) | 128.0.0.0 ~ 191.255.255.255

`클래스 C` : 네트워크부 24비트. 선두비트 110 (최대 2,097,152개 네트워크) | 192.0.0.0 ~ 223.255.255.255

#### 넷마스크

 IP주소의 네트워크부에 해당하는 부분을 1로 한 비트의 나열을 넷마스크라고 한다. 이 넷마스크와 IP주소를 대상으로 AND연산을 하면 네트워크 주소를 추려낼 수 있다. 또한 호스트부 전체를 0으로 한 주소를 네트워크 주소라고 부르며 네트워크 그 자체를 나타낸다.

</br>

### 서브넷화와 서브넷마스크

 조직의 네트워크를 작은 네트워크로 분리하는 경우가 자주 있다. 브로드캐스트가 닿는 범위가 너무 넓으면 무관한 컴퓨터에도 쓸데없는 처리를 하게 되므로 통신 능력을 낭비하게 만들기 때문이다. 또한 네트워크 장애의 영향 범위를 최소한으로 줄이기 위해 한 개의 거대한 네트워크를 만들지 않고 물리적인 배치나 조직 등을 단위로 해서 작은 네트워크를 만들고 이들을 연결시키는 구성이 일반적으로 이용된다.

 작은 네트워크로 나눠서 이들을 연결하는 구성을 서브넷화라고 한다. 서브넷화를 하는 경우 IP 주소 중의 네트워크부를 더욱 연장하고 호스트부를 줄인다. 즉, 호스트부의 일부까지 네트워크부로 사용한다. 연장할수록 한 개의 서브넷 내에서 컴퓨터에 부여할 수 있는 주소가 줄어들게 된다. 서브넷마스크 또한 연장된 비트만큼 1일 부분이 연장되며 일반적으로는 넷마스크와 서브넷마스크를 구별하지 않고 사용하는 경우가 많다.

</br>

### 브로드캐스트와 멀티캐스트

#### 브로드 캐스트

 IP 프로토콜을 이용한 통신에서는 1:1로 하는 통신을 `유니캐스트`라고 부르는 반면 동일한 이더넷에 접속해 있는 컴퓨터 전체로 데이터를 보내는 통신을 `브로드캐스트`라고 한다. 브로드캐스트를 이용하는 대표적인 프로토콜에는 ARP나 DHCP 등이 있다.

 브로드 캐스트를 할 때는 **255.255.255 (리미티드 브로드캐스트 주소, limited broadcast address)**로 패킷을 보내거나, **IP주소의 호스트부 전체를 1로 만든 주소 (디렉티드 브로드캐스트 주소, directed broadcast address)**로 패킷을 보낸다. 브로드캐스트 주소로 송신된 정보는 네트워크 내에 있는 컴퓨터 전체 대상으로 전송되지만 라우터에 연결된 다른 네트워크에는 전송되지 않는다.

#### 멀티캐스트

 멀티캐스트는 어떤 그룹에 포함된 특정 컴퓨터에 한정해서 데이터를 보내는 것이다. 멀티캐스트를 하는 경우에는 IP 주소로 클래스 D의 주소가 사용된다. 멀티 캐스트 안에서도 IP 멀티캐스트로 불리는 기술을 사용하면 네트워크에 부하가 가지 않게 특정 컴퓨터군에 대해서만 영상이나 음악을 전송할 수 있다.

</br>

### 허브/스위치의 역할과 기능

허브/스위치는 물리층과 데이터링크층의 프로토콜인 이더넷으로 인터넷 프레임을 전송하는 기능을 수행한다. 즉, 허브/스위치는 이더넷 신설이나 확장에 사용된다.

`허브` 와 `스위치`는 본래 동일한 것을 가리키는 용어이다. 최근에는 데이터 전송 기능만 가진 단순한 물건을 허브라고 부르며 그 외의 각종 관리 기능이나 VLAN 기능 등을 가진 것을 스위치라고 부르는 경우가 많다.

</br>

### 라우터의 역할과 기능

라우터는 네트워크의 중심적인 역할을 담당한다. 라우터는 OSI 참조모델에서 물리층~네트워크층의 범위에서 동작하며 네트워크층의 프로토콜인 **IP로 IP 패킷을 전송하는 동작**을 한다. 서로 독립되어 있는 이더넷 네트워크 사이에서 양쪽의 패킷(정보)을 중계하는 것이라고 말할 수도 있다.







